graph TB
    %% User Management
    User([User])
    UI[UI<br/>React SPA]
    Cognito[Cognito]
    UserAPI[User Management API<br/>Lambda]
    Dexcom[Dexcom API]
    UsersDB[(Users Table)]

    %% Data Ingestion
    DailySchedule{{EventBridge<br/>Daily}}
    IngestionCoord[Ingestion Coordinator<br/>Lambda]
    IngestionQueue[SQS Queue]
    IngestionWorker[Ingestion Worker<br/>Lambda]
    S3[(S3 Bucket<br/>Normalized Data)]

    %% Data Processing
    WeeklySchedule{{EventBridge<br/>Weekly Sundays}}
    ProcessingCoord[Processing Coordinator<br/>Lambda]
    ProcessingQueue[SQS Queue]
    Processor[Processor<br/>Lambda]
    InsightsDB[(Insights Table)]

    %% User Management Flow
    User --> UI
    UI --> Cognito
    UI --> UserAPI
    UserAPI --> Dexcom
    UserAPI --> UsersDB

    %% Data Ingestion Flow
    DailySchedule --> IngestionCoord
    IngestionCoord --> UsersDB
    IngestionCoord --> IngestionQueue
    IngestionQueue --> IngestionWorker
    IngestionWorker --> Dexcom
    IngestionWorker --> S3

    %% Data Processing Flow
    WeeklySchedule --> ProcessingCoord
    ProcessingCoord --> UsersDB
    ProcessingCoord --> ProcessingQueue
    ProcessingQueue --> Processor
    Processor --> S3
    Processor --> InsightsDB
    InsightsDB -.-> Processor

    %% Styling
    classDef lambda fill:#FF9900,stroke:#232F3E,stroke-width:2px,color:#fff
    classDef storage fill:#3B48CC,stroke:#232F3E,stroke-width:2px,color:#fff
    classDef external fill:#00C853,stroke:#232F3E,stroke-width:2px,color:#fff
    classDef schedule fill:#E7157B,stroke:#232F3E,stroke-width:2px,color:#fff

    class Cognito,UserAPI,IngestionCoord,IngestionWorker,ProcessingCoord,Processor lambda
    class UsersDB,S3,InsightsDB,IngestionQueue,ProcessingQueue storage
    class Dexcom external
    class DailySchedule,WeeklySchedule schedule
